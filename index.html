<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>MANA WAR Prototype</title>
    <link rel="stylesheet" href="./style.css" />
</head>
<body>
  <div class="wrap">
    <div class="hud">
      <div class="left">
        <div class="chip">🎮 스테이지 <b id="stageHud">-</b></div>
        <div class="chip">🧩 기믹 <b id="gimmickHud">-</b></div>
        <div class="chip">⏱️ 남은 시간 <b id="time">120.0</b>s</div>
        <div class="chip">⏳ 플레이 <b id="play">0.0</b>s</div>
        <div class="chip">🔷 마나 <b id="mana">0</b> / <span id="manaMax">100</span></div>
        <div class="chip" id="fxChip">💱 환율 <b id="fx">1000</b> <span>(배수 <b id="fxMul">1.00</b>x)</span> <span style="opacity:.85">|</span> 예고 <b id="fxNext">-</b> <small>(<span id="fxCd">3.0</span>s)</small></div>
        <div class="chip">📛 보스 <b id="bossName">-</b></div>
        <div class="chip">⚠️ 현재 패턴 <b id="patternText">-</b></div>
        <div class="chip">⏳ 다음 패턴 <b id="nextPatternText">-</b></div>
        <div class="chip warn" id="doomChip" style="display:none;">💀 <span id="doomLabel">강제청산까지</span> <b id="doomText">-</b><span id="doomUnit">s</span></div>
      </div>
      <div class="right">
        <div class="chip">🧾 점수 <b id="score">0</b></div>
        <div class="chip">🪙 재화 <b id="coins">0</b></div>
        <div class="chip">🏰 아군 본진 HP <b id="baseP">3000</b></div>
        <div class="chip">🧱 적 본진 HP <b id="baseE">3000</b></div>
        <button class="btn" id="openStageBtn" type="button">스테이지</button>
        <button class="btn" id="openLoadoutBtn" type="button">장비/토템</button>
      </div>
    </div>

    <div class="progressWrap">
      <div class="progressLine">
        <div style="font-size:16px;">🥬</div>
        <div class="barOuter"><div class="barInner" id="progressBar"></div></div>
        <div style="font-size:16px;">🍔</div>
      </div>
      <div style="opacity:.85;font-size:13px;">진척도 <b id="progressPct">0</b>%</div>
    </div>

    <div style="position:relative">
      <canvas id="game" width="1100" height="520"></canvas>
      <div class="overlay"><div class="msg" id="overlayMsg">-</div></div>
    </div>

    <div class="bar">
      <div class="cards" id="cards"></div>
      <div class="hint">
        1레인 2D · 소환 위치는 <b>본진 앞 고정</b><br/>
        단축키: <span class="kbd">1</span> <span class="kbd">2</span> <span class="kbd">3</span> 소환
        <div style="margin-top:8px;">
          <b>규칙</b><br/>
          • 카드 UI에는 <b>성능(스탯) 미표기</b><br/>
          • 패턴 발동 <b>2초 전</b>부터 진동(화면 흔들림)
        </div>
      </div>
    </div>

    <div class="dbg" id="dbg"></div>
  </div>

  <!-- Title -->
  <div class="modalBack" id="titleModal" aria-hidden="true">
    <div class="modalPanel titlePanel" role="dialog" aria-modal="true">
      <div class="badge">🐜 마나 워 · 개미의 반란</div>
      <div class="gameTitle">MANA WAR</div>
      <div class="subTitle">
        HTML 프로토타입 · "냥켓 대전쟁/팔라독" 스타일 1레인
        <br/><span style="opacity:.78">(환율 3초 전 예고 · 강제청산 패턴 포함)</span>
      </div>
      <div class="titleActions">
        <button class="btn primary" id="startBtn" type="button">START</button>
        <button class="btn" id="howBtn" type="button">HOW TO</button>
      </div>
      <div style="margin-top:12px;opacity:.78;font-size:12px;line-height:1.55;">
        * 진행도/장착/등급은 브라우저에 저장됩니다(LocalStorage).
      </div>
    </div>
  </div>

  <!-- How To -->
  <div class="modalBack" id="howModal" data-pauses="true" aria-hidden="true">
    <div class="modalPanel titlePanel" role="dialog" aria-modal="true">
      <div class="badge">📖 HOW TO PLAY</div>
      <div class="subTitle" style="text-align:left;max-width:720px;margin:14px auto 0;">
        • START → 스테이지 선택 또는 장비/토템
        <br/>• 전투 중: <span class="kbd">1</span> / <span class="kbd">2</span> / <span class="kbd">3</span> 소환
        <br/>• 강제청산(튜토리얼): 게임 시작 <b>105초</b>에 <b>본진/마나 0</b> → 즉시 패배
        <br/>• 환율: 변경 <b>3초 전</b> 예고 UI 표시
        <br/>• 패턴: 발동 <b>2초 전</b>부터 화면 진동
        <br/>• 카드 UI에는 <b>스탯 미표기</b>(비용만)
        <br/>• 장비/토템: 1연/10연 뽑기, 중복은 <b>x수량</b>으로 누적, 정렬 변경 가능
      </div>
      <div class="titleActions" style="margin-top:16px;">
        <button class="btn primary" id="howCloseBtn" type="button">닫기</button>
      </div>
    </div>
  </div>

  <!-- Start Menu -->
  <div class="modalBack" id="startMenuModal" aria-hidden="true">
    <div class="modalPanel titlePanel" role="dialog" aria-modal="true">
      <div class="badge">🏁 시작 메뉴</div>
      <div class="subTitle">게임을 시작하기 전에 스테이지를 고르거나, 장비/토템을 뽑아 장착할 수 있어요.</div>
      <div class="menuGrid">
        <button class="menuCard" id="goStageSelectBtn" type="button">
          <h3>🎮 스테이지 선택</h3>
          <p>1~7 스테이지 · 각 스테이지 세부 1~7<br/>세부 4는 중간보스</p>
        </button>
        <button class="menuCard" id="goLoadoutBtn" type="button">
          <h3>🧿 장비/토템</h3>
          <p>장비 3개 · 토템 3개 장착 가능<br/>뽑기(1연/10연) → 인벤 → 장착</p>
        </button>
      </div>
      <div class="titleActions" style="margin-top:14px;">
        <button class="btn" id="startMenuBackBtn" type="button">타이틀</button>
      </div>
    </div>
  </div>

  <!-- Stage Select -->
  <div class="modalBack" id="stageModal" data-pauses="true" aria-hidden="true">
    <div class="modalPanel" role="dialog" aria-modal="true">
      <div class="stageHeader">
        <div>
          <h2>스테이지 선택</h2>
          <p>
            (프로토타입) 현재는 모든 스테이지 선택 가능.
            <br/>세부 <b>4</b>는 <b>중간보스</b>.
          </p>
        </div>
        <div style="display:flex;gap:10px;align-items:flex-start;flex-wrap:wrap;justify-content:flex-end;">
          <button class="btn" id="resetProgressBtn" type="button">진행도 초기화</button>
          <button class="btn" id="backToTitleBtn" type="button">타이틀</button>
        </div>
      </div>

      <div class="stageLayout">
        <div class="box">
          <h3>메인 스테이지 (1~7)</h3>
          <div class="mainGrid" id="mainStageGrid"></div>
        </div>

        <div class="box">
          <h3>세부 스테이지 (선택된 메인: <span id="selectedMain">-</span>)</h3>
          <div class="subGrid" id="subStageGrid"></div>
          <div class="actions">
            <button class="btn" id="closeStageBtn" type="button">닫기</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Loadout -->
  <div class="modalBack" id="loadoutModal" data-pauses="true" aria-hidden="true">
    <div class="modalPanel" role="dialog" aria-modal="true">
      <div class="loadoutTop">
        <div>
          <h2 style="margin:0;font-size:22px;font-weight:1000;">장비 / 토템</h2>
          <div class="small" style="margin-top:6px;">
            • 장비 3개 / 토템 3개 장착 가능<br/>
            • 인벤 아이템 클릭 → 빈 슬롯에 자동 장착<br/>
            • 슬롯 클릭 → 해제(인벤으로 복귀)
          </div>
        </div>
        <div style="display:flex;gap:10px;flex-wrap:wrap;justify-content:flex-end;align-items:flex-start;">
          <div class="chip">장착 <b id="equipCount">장비 0/3 · 토템 0/3</b></div>
          <button class="btn" id="loadoutCloseBtn" type="button">닫기</button>
        </div>
      </div>

      <div class="tabs">
        <button class="tab active" id="tabEquip" type="button">장비</button>
        <button class="tab" id="tabTotem" type="button">토템</button>
      </div>

      <div class="grid2" style="margin-top:10px;">
        <div class="box">
          <h3>장착 슬롯</h3>
          <div class="slotRow" id="slotRow"></div>
          <div class="actions">
            <button class="btn primary" id="draw1Btn" type="button">1연 뽑기</button>
            <button class="btn primary" id="draw10Btn" type="button">10연 뽑기</button>
            <button class="btn" id="clearInvBtn" type="button">인벤 비우기</button>
          </div>
          <div style="margin-top:10px;display:flex;gap:10px;align-items:center;flex-wrap:wrap;">
            <div class="chip" style="gap:8px;">정렬
              <select id="sortSelect" class="sel" aria-label="inventory sort">
                <option value="grade">등급순(높은→낮은)</option>
                <option value="qty_desc">수량순(많은→적은)</option>
                <option value="qty_asc">수량순(적은→많은)</option>
              </select>
            </div>
            <div class="small">* 등급순: 높은 등급이 위 · 수량순: 많은/적은 순 선택 가능</div>
          </div>
          <div class="small" style="margin-top:10px;">
            * 같은 이름(같은 ID)의 아이템은 등급이 1개로 고정됩니다.
            <br/>* 토템은 "차트 패턴" 아이콘으로 표시됩니다.
          </div>
        </div>
        <div class="box">
          <h3>인벤토리</h3>
          <div class="invScroll"><div class="inv" id="invWrap"></div></div>
        </div>
      </div>
    </div>
  </div>

  <!-- End -->
  <div class="modalBack" id="endModal" data-pauses="true" aria-hidden="true">
    <div class="modalPanel endPanel" role="dialog" aria-modal="true">
      <div class="endTop">
        <div class="stageBadge2"><div class="code" id="endStage">1-01</div><div class="lv">STAGE</div></div>
        <div class="endTitle" id="endTitle">CLEARED</div>
        <div class="stars" aria-label="burgers">
          <div class="star" id="star1">🍔</div>
          <div class="star" id="star2">🍔</div>
          <div class="star" id="star3">🍔</div>
        </div>
      </div>

      <div class="endBody">
        <div>
          <div class="summary">
            <div class="row"><div class="k">점수</div><div class="v" id="endScore">0</div></div>
            <div class="row"><div class="k">재화</div><div class="v" id="endCoins">0</div></div>
            <div class="row"><div class="k">플레이 시간</div><div class="v"><span id="endTime">0.0</span>s</div></div>
            <div class="row"><div class="k">진척도 (🥬→🍔)</div><div class="v"><span id="endProgress">0</span>%</div></div>
            <div class="row"><div class="k">처치</div><div class="v" id="endKills">0</div></div>
            <div class="row"><div class="k">적 본진 피해 누적</div><div class="v" id="endDmg">0</div></div>
          </div>
          <div class="bonusLine">
            <div>🏆 PROGRESS BONUS <span class="pill" id="bonusWhy">기본</span></div>
            <div>🪙 <span id="endBonus">0</span></div>
          </div>
        </div>

        <div>
          <div class="mapBox">
            <div class="mapTitle"><div>🗺️ 스테이지 진척도</div><small><span id="campaignPct">0</span>%</small></div>
            <div class="stageMap" id="stageMap"></div>
            <div style="margin-top:12px;display:flex;gap:10px;align-items:center;">
              <div style="font-size:16px;">🥬</div>
              <div class="barOuter"><div class="barInner" id="campaignBar"></div></div>
              <div style="font-size:16px;">🍔</div>
            </div>
            <div style="opacity:.78;font-size:12px;margin-top:10px;line-height:1.4;">
              * 햄버거 점등: <b>30%</b> / <b>60%</b> / <b>90%</b>
              <br/>* 단축키: <span class="kbd">R</span> 재시작 / <span class="kbd">N</span> 다음
            </div>
          </div>
          <div class="actions">
            <button class="btn danger" id="retryBtn" type="button">RETRY</button>
            <button class="btn primary" id="nextBtn" type="button">NEXT</button>
          </div>
        </div>
      </div>

    </div>
  </div>

  <script src="./app.js" defer></script>
</body>
</html>
